# Migration `20200420111303-new_link`

This migration has been generated by Tom Chauveau at 4/20/2020, 11:13:03 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Role" (
    "add_member" boolean   DEFAULT false,
    "add_role" boolean   DEFAULT false,
    "admin" boolean   DEFAULT false,
    "create_pro" boolean   DEFAULT false,
    "id" text  NOT NULL ,
    "name" text  NOT NULL ,
    "recommend" boolean   DEFAULT false,
    "write" boolean   DEFAULT false,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."_ProjectToUser" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE TABLE "public"."_RoleToUser" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

ALTER TABLE "public"."Project" DROP CONSTRAINT IF EXiSTS "Project_userId_fkey",
DROP COLUMN "userId";

CREATE UNIQUE INDEX "Role.name" ON "public"."Role"("name")

CREATE UNIQUE INDEX "_ProjectToUser_AB_unique" ON "public"."_ProjectToUser"("A","B")

CREATE  INDEX "_ProjectToUser_B_index" ON "public"."_ProjectToUser"("B")

CREATE UNIQUE INDEX "_RoleToUser_AB_unique" ON "public"."_RoleToUser"("A","B")

CREATE  INDEX "_RoleToUser_B_index" ON "public"."_RoleToUser"("B")

CREATE UNIQUE INDEX "Project.name" ON "public"."Project"("name")

ALTER TABLE "public"."_ProjectToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Project"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ProjectToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_RoleToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Role"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_RoleToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."Roles";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200419173114-init..20200420111303-new_link
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -18,34 +18,33 @@
     Done
 }
 model Project {
-    id       String      @default(uuid()) @id
-    name     String
-    status   Status
-    airtable String?
-    github   String?
-    user     User        @relation(fields: [userId], references: [id])
-    userId   String
+    id          String    @default(uuid()) @id
+    name        String    @unique
+    status      Status
+    airtable    String?
+    github      String?
+    users       User[]    @relation(references: [id])
 }
-model Roles {
+// Roles
+model Role {
     id          String   @default(uuid()) @id
     name        String   @unique
-    admin       Boolean  @default(false)
-    add_role    Boolean  @default(false)
-    recommend   Boolean  @default(false)
-    write       Boolean  @default(false)
-    add_member  Boolean  @default(false)
-    create_pro  Boolean  @default(false)
-    user        User?    @relation(fields: [userId], references: [id])
-    userId      String?
+    admin       Boolean? @default(false)
+    add_role    Boolean? @default(false)
+    recommend   Boolean? @default(false)
+    write       Boolean? @default(false)
+    add_member  Boolean? @default(false)
+    create_pro  Boolean? @default(false)
+    users       User[]   @relation(references: [id])
 }
 // User model
 model User {
-    id       String      @default(uuid()) @id
-    mail     String      @unique
-    token    String?     @unique
-    roles    Roles?
-    project  Project[]
+    id           String      @default(uuid()) @id
+    mail         String      @unique
+    token        String?     @unique
+    roles        Role[]      @relation(references: [name])
+    projects     Project[]   @relation(references: [name])
 }
```


